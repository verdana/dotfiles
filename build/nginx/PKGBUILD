# $Id: $
# Maintainer: Verdana Mu <verdana.cn@gmail.com>

pkgname=nginx
pkgver=1.5.7
pkgrel=1
pkgdesc='Nginx Web Server'
arch=('i686' 'x86_64')
url='http://nginx.org'
license=('GPL')

depends=('curl')
makedepends=()

pkgver()
{
    msg2 "Checking latest version..."
    local version=`curl -s http://nginx.org/en/CHANGES | grep -m1 "^Changes with nginx" | awk '{print $4}'`
    msg2 "Nginx version - $version"
    printf $version
}

prepare()
{
    # Download the latest nginx tarball
    msg2 "Download nginx tarball..."
    curl -s -O "http://nginx.org/download/nginx-$pkgver.tar.gz"

    msg2 "Download the PGP signature file..."
    curl -s -O "http://nginx.org/download/nginx-$pkgver.tar.gz.asc"

    msg2 "Checking signature..."
    gpg nginx-$pkgver.tar.gz.asc

    msg2 "Extracting tarball..."
    tar -zxf nginx-$pkgver.tar.gz
}

build()
{
    cd $srcdir/nginx-$pkgver
    ./configure                                             \
        --prefix="/usr/share/nginx"                         \
        --sbin-path="/usr/bin/nginx"                        \
        --conf-path="/etc/nginx/nginx.conf"                 \
        --pid-path="/var/run/nginx.pid"                     \
        --lock-path="/var/lock/nginx.lock"                  \
        --user=http                                         \
        --group=http                                        \
        --http-log-path="/var/log/nginx/access.log"         \
        --error-log-path="/var/log/nginx/error.log"         \
        --http-client-body-temp-path="/tmp/client-body"     \
        --http-proxy-temp-path="/tmp/proxy"                 \
        --http-fastcgi-temp-path="/tmp/fastcgi"             \
        --http-scgi-temp-path="/tmp/scgi"                   \
        --http-uwsgi-temp-path="/tmp/uwsgi"                 \
        --with-http_ssl_module                              \
        --with-pcre                                         \
        --with-pcre-jit                                     \
        --with-cc-opt="-D FD_SETSIZE=2048"
}

package()
{
    msg "package nginx"
    cd $srcdir/nginx-$pkgver
    make -j2 DESTDIR="$pkgdir" install
}

# vim: set fdm=marker ff=unix sw=4 ts=4 et:

